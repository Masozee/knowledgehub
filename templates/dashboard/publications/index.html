{% extends 'dashboard/publications/base.html' %}
{% load static %}

{% block content %}
    
    <div class="nk-content-body">
        <div class="nk-content-wrap">
            <div class="nk-block-head nk-block-head-sm">
                <div class="nk-block-between">
                    <div class="nk-block-head-content">
                        <h3 class="nk-block-title page-title">Overview</h3>
                        <div class="nk-block-des text-soft">
                            <p>Welcome to Knowledgehub Dashboard Template.</p>
                        </div>
                    </div><!-- .nk-block-head-content -->
                    <div class="nk-block-head-content">
                        <div class="toggle-wrap nk-block-tools-toggle">
                            <a href="#" class="btn btn-icon btn-trigger toggle-expand me-n1" data-target="pageMenu"><em class="icon ni ni-more-v"></em></a>
                            <div class="toggle-expand-content" data-content="pageMenu">
                                <ul class="nk-block-tools g-3">
                                    <li>
                                        <div class="drodown">
                                            <a href="#" class="dropdown-toggle btn btn-white btn-dim btn-outline-light" data-bs-toggle="dropdown"><em class="d-none d-sm-inline icon ni ni-calender-date"></em><span><span class="d-none d-md-inline">Last</span> 30 Days</span><em class="dd-indc icon ni ni-chevron-right"></em></a>
                                            <div class="dropdown-menu dropdown-menu-end">
                                                <ul class="link-list-opt no-bdr">
                                                    <li><a href="#"><span>Last 30 Days</span></a></li>
                                                    <li><a href="#"><span>Last 6 Months</span></a></li>
                                                    <li><a href="#"><span>Last 1 Years</span></a></li>
                                                </ul>
                                            </div>
                                        </div>
                                    </li>
                                    <li class="nk-block-tools-opt"><a href="#" class="btn btn-primary"><em class="icon ni ni-reports"></em><span>Reports</span></a></li>
                                </ul>
                            </div>
                        </div>
                    </div><!-- .nk-block-head-content -->
                </div><!-- .nk-block-between -->
            </div><!-- .nk-block-head -->
            <div class="nk-block">
                <div class="row g-gs">
                    
                    <div class="col-xl-6">
                        <div class="card card-bordered h-100">
                            <div class="card-inner">
                                <div class="card-title-group align-start mb-2">
                                    <div class="card-title">
                                        <h6 class="title">Publications Viewer</h6>
                                        <p>In last 30 days revenue from subscription.</p>
                                    </div>
                                    <div class="card-tools">
                                        <em class="card-hint icon ni ni-help-fill" data-bs-toggle="tooltip" data-bs-placement="left" title="Revenue from subscription"></em>
                                    </div>
                                </div>
                                <div class="align-end gy-3 gx-5 flex-wrap flex-md-nowrap flex-xl-wrap">
                                    <div class="nk-sale-data-group flex-md-nowrap g-4">
                                        <div class="nk-sale-data">
                                            <span class="amount">14,299.59 <span class="change down text-danger"><em class="icon ni ni-arrow-long-down"></em>16.93%</span></span>
                                            <span class="sub-title">This Month</span>
                                        </div>
                                        <div class="nk-sale-data">
                                            <span class="amount">7,299.59 <span class="change up text-success"><em class="icon ni ni-arrow-long-up"></em>4.26%</span></span>
                                            <span class="sub-title">This Week</span>
                                        </div>
                                    </div>
                                    <div class="nk-sales-ck sales-revenue">
                                        <canvas class="sales-bar-chart" id="salesRevenue"></canvas>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div><!-- .col -->
                    <div class="col-xl-6">
                        <div class="card card-bordered h-100">
                            <div class="card-inner">
                                <div class="card-title-group align-start gx-3 mb-3">
                                    <div class="card-title">
                                        <h6 class="title">Visitor Overview</h6>
                                        <p>In 30 days Visitor.</p>
                                    </div>
                                    <div class="card-tools">
                                        <div class="dropdown">
                                            <a href="#" class="btn btn-primary btn-dim d-none d-sm-inline-flex" data-bs-toggle="dropdown"><em class="icon ni ni-download-cloud"></em><span>Report</span></a>
                                            <a href="#" class="btn btn-icon btn-primary btn-dim d-sm-none" data-bs-toggle="dropdown"><em class="icon ni ni-download-cloud"></em></a>
                                            <div class="dropdown-menu dropdown-menu-end">
                                                <ul class="link-list-opt no-bdr">
                                                    <li><a href="#"><span>Download Mini Version</span></a></li>
                                                    <li><a href="#"><span>Download Full Version</span></a></li>
                                                    <li class="divider"></li>
                                                    <li><a href="#"><em class="icon ni ni-opt-alt"></em><span>More Options</span></a></li>
                                                </ul>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="nk-sale-data-group align-center justify-between gy-3 gx-5">
                                    <div class="nk-sale-data">
                                        <span class="amount">82,944.60</span>
                                    </div>
                                    <div class="nk-sale-data">
                                        <span class="amount sm">1,937 <small>Downloads</small></span>
                                    </div>
                                </div>
                                <div class="nk-sales-ck large pt-4">
                                    <canvas class="sales-overview-chart" id="salesOverview"></canvas>
                                </div>
                            </div>
                        </div><!-- .card -->
                    </div><!-- .col -->
                    <div class="col-12">
    <div class="card card-bordered card-full">
        <div class="card-inner">
            <div class="card-title-group">
                <div class="card-title">
                    <h6 class="title">
                        <span class="me-2">Recent Publications</span>
                        <a href="{% url 'publications:index' %}" class="link d-none d-sm-inline">View Archive</a>
                    </h6>
                </div>
                <div class="card-tools">
                    <ul class="card-tools-nav">
                        <li {% if current_status == 'published' %}class="active"{% endif %}>
                            <a href="/?status=published"><span>Published</span></a>
                        </li>
                        <li {% if current_status == 'draft' %}class="active"{% endif %}>
                            <a href="/?status=draft"><span>Draft</span></a>
                        </li>
                        <li {% if current_status == 'all' %}class="active"{% endif %}>
                            <a href="/?status=all"><span>All</span></a>
                        </li>
                    </ul>
                </div>
            </div>
        </div>
        <div class="card-inner p-0 border-top">
            <div class="nk-tb-list nk-tb-publications">
                <!-- Table Header -->
                <div class="nk-tb-item nk-tb-head">
                    <div class="nk-tb-col"><span>Title</span></div>
                    <div class="nk-tb-col tb-col-sm"><span>Authors</span></div>
                    <div class="nk-tb-col tb-col-md"><span>Date</span></div>
                    <div class="nk-tb-col tb-col-lg"><span>Category</span></div>
                    <div class="nk-tb-col"><span>Downloads</span></div>
                    <div class="nk-tb-col"><span class="d-none d-sm-inline">Status</span></div>
                    <div class="nk-tb-col"><span>&nbsp;</span></div>
                </div>

                <!-- Publications List -->
                {% for publication in publications %}
                <div class="nk-tb-item">
                    <div class="nk-tb-col">
                        <span class="tb-lead"><a href="{% url 'publications:publication-detail' publication.slug %}">{{ publication.title|truncatechars:40 }}</a></span>
                    </div>
                    <div class="nk-tb-col tb-col-sm">
                        <div class="user-card">
                            {% with first_author=publication.publicationauthor_set.first %}
                            {% if first_author %}
                            <div class="user-avatar user-avatar-sm bg-primary">
                                <span>{{ first_author.author.get_initials }}</span>
                            </div>
                            <div class="user-name">
                                <span class="tb-lead">{{ first_author.author.get_full_name }}</span>
                                {% if publication.authors.count > 1 %}
                                <span class="tb-sub">+{{ publication.authors.count|add:"-1" }} more</span>
                                {% endif %}
                            </div>
                            {% endif %}
                            {% endwith %}
                        </div>
                    </div>
                    <div class="nk-tb-col tb-col-md">
                        <span class="tb-sub">{{ publication.date_publish|date:"d/m/Y" }}</span>
                    </div>
                    <div class="nk-tb-col tb-col-lg">
                        <span class="tb-sub text-primary">{{ publication.category.name|default:"-" }}</span>
                    </div>
                    <div class="nk-tb-col">
                        <span class="tb-sub tb-amount">{{ publication.download_count }} <span>downloads</span></span>
                    </div>
                    <div class="nk-tb-col">
                        {% if publication.status == 'published' and publication.publish %}
                            <span class="badge badge-dot badge-dot-xs bg-success">Published</span>
                        {% elif publication.status == 'draft' %}
                            <span class="badge badge-dot badge-dot-xs bg-warning">Draft</span>
                        {% elif publication.status == 'archived' %}
                            <span class="badge badge-dot badge-dot-xs bg-grey">Archived</span>
                        {% endif %}
                    </div>
                    <div class="nk-tb-col nk-tb-col-action">
                        <div class="dropdown">
                            <a class="text-soft dropdown-toggle btn btn-icon btn-trigger" data-bs-toggle="dropdown">
                                <em class="icon ni ni-more-h"></em>
                            </a>
                            <div class="dropdown-menu dropdown-menu-end dropdown-menu-xs">
                                <ul class="link-list-plain">
                                    <li><a href="{% url 'publications:publication-detail' publication.slug %}">View</a></li>
                                    {% if publication.file %}
                                        <li><a href="{% url 'publications:publication-download' publication.slug %}">Download</a></li>
                                    {% endif %}
                                    {% if user.is_staff %}
                                        <li><a href="{% url 'admin:publications_publication_change' publication.id %}">Edit</a></li>
                                    {% endif %}
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
                {% empty %}
                <div class="nk-tb-item">
                    <div class="nk-tb-col text-center" colspan="7">
                        <span class="text-muted">No publications found</span>
                    </div>
                </div>
                {% endfor %}
            </div>
        </div>
        
        <!-- Pagination -->
        {% if is_paginated %}
        <div class="card-inner">
            <div class="nk-block-between-md g-3">
                <div class="g">
                    {% if page_obj.has_previous %}
                    <a href="/?page={{ page_obj.previous_page_number }}{% if request.GET.status %}&status={{ request.GET.status }}{% endif %}" 
                       class="btn btn-white btn-dim btn-sm">
                        <em class="icon ni ni-chevron-left"></em>
                        <span>Previous</span>
                    </a>
                    {% endif %}
                </div>
                <div class="g">
                    <div class="pagination-goto d-flex justify-content-center justify-content-md-start gx-3">
                        <div>Page {{ page_obj.number }} of {{ page_obj.paginator.num_pages }}</div>
                    </div>
                </div>
                <div class="g">
                    {% if page_obj.has_next %}
                    <a href="/?page={{ page_obj.next_page_number }}{% if request.GET.status %}&status={{ request.GET.status }}{% endif %}" 
                       class="btn btn-white btn-dim btn-sm">
                        <span>Next</span>
                        <em class="icon ni ni-chevron-right"></em>
                    </a>
                    {% endif %}
                </div>
            </div>
        </div>
        {% endif %}
    </div>
</div>
                    
                </div><!-- .row -->
            </div><!-- .nk-block -->
        </div>
        <!-- footer @s -->
        <div class="nk-footer">
            <div class="container wide-xl">
                <div class="nk-footer-wrap g-2">
                    <div class="nk-footer-copyright"> &copy; 2023 Knowledgehub. Template by <a href="https://softnio.com" target="_blank">Softnio</a>
                    </div>
                    <div class="nk-footer-links">
                        <ul class="nav nav-sm">
                            <li class="nav-item dropup">
                                <a href="#" class="dropdown-toggle dropdown-indicator has-indicator nav-link text-base" data-bs-toggle="dropdown" data-offset="0,10"><span>English</span></a>
                                <div class="dropdown-menu dropdown-menu-sm dropdown-menu-end">
                                    <ul class="language-list">
                                        <li>
                                            <a href="#" class="language-item">
                                                <span class="language-name">English</span>
                                            </a>
                                        </li>
                                        <li>
                                            <a href="#" class="language-item">
                                                <span class="language-name">Español</span>
                                            </a>
                                        </li>
                                        <li>
                                            <a href="#" class="language-item">
                                                <span class="language-name">Français</span>
                                            </a>
                                        </li>
                                        <li>
                                            <a href="#" class="language-item">
                                                <span class="language-name">Türkçe</span>
                                            </a>
                                        </li>
                                    </ul>
                                </div>
                            </li>
                            <li class="nav-item">
                                <a data-bs-toggle="modal" href="#region" class="nav-link"><em class="icon ni ni-globe"></em><span class="ms-1">Select Region</span></a>
                            </li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
        <!-- footer @e -->
    </div>
                        

{% endblock %}

{% block js %}
<script src="{% static 'dashboard/assets/js/charts/gd-default.js' %}"></script>
{% endblock %}